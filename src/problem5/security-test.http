###############################################
# Security Testing Suite
# Tests for SQL Injection, XSS, Rate Limiting, etc.
###############################################

@baseUrl = http://localhost:3400
@contentType = application/json

###############################################
# 1. SQL Injection Tests
###############################################

### Test SQL injection in name query parameter
GET {{baseUrl}}/api/resources?name=' OR '1'='1 HTTP/1.1

###

### Test SQL injection with DROP TABLE
GET {{baseUrl}}/api/resources?name='; DROP TABLE resources; -- HTTP/1.1

###

### Test SQL injection in search parameter
GET {{baseUrl}}/api/resources?search=1' UNION SELECT * FROM resources-- HTTP/1.1

###

### Test SQL injection in category filter
GET {{baseUrl}}/api/resources?category=' OR 1=1-- HTTP/1.1

###

### Test SQL injection in POST request
POST {{baseUrl}}/api/resources HTTP/1.1
Content-Type: {{contentType}}

{
  "name": "Test' OR '1'='1",
  "description": "Testing SQL injection in name field with various patterns",
  "category": "test"
}

###

### Test SQL comment injection
GET {{baseUrl}}/api/resources?name=test-- HTTP/1.1

###############################################
# 2. XSS (Cross-Site Scripting) Tests
###############################################

### Test script tag in name
POST {{baseUrl}}/api/resources HTTP/1.1
Content-Type: {{contentType}}

{
  "name": "<script>alert('XSS')</script>",
  "description": "Testing XSS with script tag in name field",
  "category": "test"
}

###

### Test script tag in description
POST {{baseUrl}}/api/resources HTTP/1.1
Content-Type: {{contentType}}

{
  "name": "XSS Test Resource",
  "description": "<script>document.cookie</script>",
  "category": "test"
}

###

### Test img tag with onerror
POST {{baseUrl}}/api/resources HTTP/1.1
Content-Type: {{contentType}}

{
  "name": "XSS Image Test",
  "description": "<img src=x onerror=alert('XSS')>",
  "category": "test"
}

###

### Test javascript protocol
POST {{baseUrl}}/api/resources HTTP/1.1
Content-Type: {{contentType}}

{
  "name": "JavaScript Protocol Test",
  "description": "<a href='javascript:alert(1)'>Click me</a>",
  "category": "test"
}

###

### Test event handler attributes
POST {{baseUrl}}/api/resources HTTP/1.1
Content-Type: {{contentType}}

{
  "name": "Event Handler Test",
  "description": "<div onclick='alert(1)'>Click me</div>",
  "category": "test"
}

###

### Test iframe injection
POST {{baseUrl}}/api/resources HTTP/1.1
Content-Type: {{contentType}}

{
  "name": "Iframe Test",
  "description": "<iframe src='http://evil.com'></iframe>",
  "category": "test"
}

###

### Test XSS in query parameter
GET {{baseUrl}}/api/resources?search=<script>alert('XSS')</script> HTTP/1.1

###############################################
# 3. HTTP Parameter Pollution Tests
###############################################

### Test duplicate parameters
GET {{baseUrl}}/api/resources?name=test1&name=test2&name=test3 HTTP/1.1

###

### Test parameter pollution with SQL injection
GET {{baseUrl}}/api/resources?category=tech&category=' OR '1'='1 HTTP/1.1

###

### Test multiple page parameters (should use first or handle safely)
GET {{baseUrl}}/api/resources?page=1&page=999 HTTP/1.1

###############################################
# 4. Large Payload Tests
###############################################

### Test payload exceeding 10kb limit (should be rejected)
POST {{baseUrl}}/api/resources HTTP/1.1
Content-Type: {{contentType}}

{
  "name": "Large Payload Test",
  "description": "Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum. Sed ut perspiciatis unde omnis iste natus error sit voluptatem accusantium doloremque laudantium, totam rem aperiam, eaque ipsa quae ab illo inventore veritatis et quasi architecto beatae vitae dicta sunt explicabo. Nemo enim ipsam voluptatem quia voluptas sit aspernatur aut odit aut fugit, sed quia consequuntur magni dolores eos qui ratione voluptatem sequi nesciunt. Neque porro quisquam est, qui dolorem ipsum quia dolor sit amet, consectetur, adipisci velit, sed quia non numquam eius modi tempora incidunt ut labore et dolore magnam aliquam quaerat voluptatem. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum. Sed ut perspiciatis unde omnis iste natus error sit voluptatem accusantium doloremque laudantium, totam rem aperiam, eaque ipsa quae ab illo inventore veritatis et quasi architecto beatae vitae dicta sunt explicabo. Nemo enim ipsam voluptatem quia voluptas sit aspernatur aut odit aut fugit, sed quia consequuntur magni dolores eos qui ratione voluptatem sequi nesciunt. Neque porro quisquam est, qui dolorem ipsum quia dolor sit amet, consectetur, adipisci velit, sed quia non numquam eius modi tempora incidunt ut labore et dolore magnam aliquam quaerat voluptatem. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur.",
  "category": "test"
}

###############################################
# 5. Special Characters and Encoding Tests
###############################################

### Test Unicode characters
POST {{baseUrl}}/api/resources HTTP/1.1
Content-Type: {{contentType}}

{
  "name": "Unicode Test ä½ å¥½",
  "description": "Testing unicode characters: Ã‘oÃ±o, cafÃ©, naÃ¯ve",
  "category": "test"
}

###

### Test null bytes
POST {{baseUrl}}/api/resources HTTP/1.1
Content-Type: {{contentType}}

{
  "name": "Null\u0000Byte\u0000Test",
  "description": "Testing null bytes in input fields for security",
  "category": "test"
}

###

### Test control characters
POST {{baseUrl}}/api/resources HTTP/1.1
Content-Type: {{contentType}}

{
  "name": "Control\nCharacter\rTest",
  "description": "Testing control characters like newline and carriage return",
  "category": "test"
}

###############################################
# 6. NoSQL Injection Tests (Defense in Depth)
###############################################

### Test MongoDB operator injection
POST {{baseUrl}}/api/resources HTTP/1.1
Content-Type: {{contentType}}

{
  "name": {"$gt": ""},
  "description": "Testing NoSQL operator injection",
  "category": "test"
}

###

### Test $where operator
GET {{baseUrl}}/api/resources?name[$where]=function() { return true; } HTTP/1.1

###

### Test nested object injection
POST {{baseUrl}}/api/resources HTTP/1.1
Content-Type: {{contentType}}

{
  "name": "NoSQL Test",
  "description": {"$ne": null},
  "category": "test"
}

###############################################
# 7. Path Traversal Tests
###############################################

### Test path traversal in ID
GET {{baseUrl}}/api/resources/../../etc/passwd HTTP/1.1

###

### Test encoded path traversal
GET {{baseUrl}}/api/resources/%2e%2e%2f%2e%2e%2fetc%2fpasswd HTTP/1.1

###

### Test double encoding
GET {{baseUrl}}/api/resources/%252e%252e%252f HTTP/1.1

###############################################
# 8. Category Validation Tests
###############################################

### Test special characters in category (should be rejected)
POST {{baseUrl}}/api/resources HTTP/1.1
Content-Type: {{contentType}}

{
  "name": "Category Test",
  "description": "Testing special characters in category field",
  "category": "test@#$%^&*()"
}

###

### Test emoji in category (should be rejected)
POST {{baseUrl}}/api/resources HTTP/1.1
Content-Type: {{contentType}}

{
  "name": "Emoji Category Test",
  "description": "Testing emoji characters in category field for validation",
  "category": "testðŸ˜€category"
}

###

### Test valid category with allowed characters
POST {{baseUrl}}/api/resources HTTP/1.1
Content-Type: {{contentType}}

{
  "name": "Valid Category Test",
  "description": "Testing valid category with allowed characters only",
  "category": "test_category-123"
}

###############################################
# 9. Security Headers Check
###############################################

### Check security headers in response
GET {{baseUrl}}/health HTTP/1.1

# Expected headers:
# - X-Content-Type-Options: nosniff
# - X-Frame-Options: DENY
# - Strict-Transport-Security: max-age=31536000; includeSubDomains
# - Content-Security-Policy

###############################################
# 10. Rate Limiting Test
###############################################

### Make multiple rapid requests (run this test last)
### Expected: After 100 requests in 15 minutes, should return 429

GET {{baseUrl}}/api/resources HTTP/1.1

### (Repeat the above request 100+ times to test rate limiting)
